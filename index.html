<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loading Costume…</title>
  <style>
    /* ===== Mobile‑first, full‑screen image with overlay header & draggable spinner ===== */
    :root{
      --bg:#0b0b0c; --fg:#f2f2f2; --muted:#b6b6b6; --spinner:52px; --ring:4px;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    /* Stage covers entire viewport */
    .stage{position:fixed; inset:0; overflow:hidden;}
    .cat{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; user-select:none; -webkit-user-drag:none; pointer-events:none;}

    /* Header microtext */
    header{position:fixed; top:0; left:0; right:0; display:flex; justify-content:center; pointer-events:none;
      padding:.75rem 1rem; background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0)); z-index:3}
    .micro{font-size:clamp(.9rem, 2.7vw, 1.05rem); color:var(--muted); text-align:center; max-width:72ch}

    /* Spinner */
    .spinner{position:absolute; width:var(--spinner); height:var(--spinner); transform:translate(-50%,-50%); display:grid; place-items:center; z-index:2;
      touch-action:none; cursor:grab}
    .spinner.dragging{cursor:grabbing}
    .ring{width:100%; height:100%; border-radius:999px; border:var(--ring) solid transparent; border-top-color:var(--fg); border-right-color:#d0d0d0; animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Subtle footer hint visible only when editing is enabled (via CONFIG) */
    .hint{position:fixed; left:50%; bottom:.8rem; transform:translateX(-50%); font-size:.85rem; color:#c8c8c8; opacity:.8; display:none}
    .hint.show{display:block}
  </style>
</head>
<body>
<header><div id="micro" class="micro">She’s trying her best. Please be patient.</div></header>
<main class="stage" id="stage" aria-label="Derpy cat loading screen">
  <img id="cat" class="cat" alt="Derpy cat" />
  <div id="spinner" class="spinner" role="img" aria-label="Loading">
    <div class="ring" aria-hidden="true"></div>
  </div>
</main>
<div id="hint" class="hint">Drag to place spinner · position auto-saves for this photo</div>

<script>
  /* =====================
     CONFIG — edit only this
     ===================== */
  const IMAGES = [
    // Add your files under /images and list them here with default spinner % coords
    { src: "images/cat_1.jpeg", alt: "Derpy cat 1", spinner:{ x:12.61, y:53.56 } },
    { src: "images/cat_2.jpeg", alt: "Derpy cat 2", spinner:{ x:40, y:62 } },
    { src: "images/cat_3.jpeg", alt: "Derpy cat 3", spinner:{ x:48.14, y:49.94 } },
    { src: "images/cat_4.jpeg", alt: "Derpy cat 4", spinner:{ x:66.85, y:24.27 } },
    { src: "images/cat_5.jpeg", alt: "Derpy cat 5", spinner:{ x:39.28, y:42.58 } },
    { src: "images/cat_6.jpeg", alt: "Derpy cat 6", spinner:{ x:26.86, y:79.24 } },
  ];

  const CONFIG = {
    draggable: true,             // enable/disable dragging globally (no UI)
    preventImmediateRepeat: true,// avoid same image twice in a row
    microtexts: [
      "She’s trying her best. Please be patient.",
      "Attempting fur-based costume compilation…",
      "Optimizing whiskers (0% complete).",
      "Engaging purr protocol…",
      "Furball detected. Retrying…",
      "Every refresh makes her more powerful.",
    ],
    microtextRotateMs: 5000,     // 0 to disable rotation
    defaultSpinner:{ x:50, y:50 } // fallback if image entry omits spinner
  };

  /* =====================
     RUNTIME — no need to edit
     ===================== */
  const stage = document.getElementById('stage');
  const imgEl = document.getElementById('cat');
  const spinner = document.getElementById('spinner');
  const micro = document.getElementById('micro');
  const hint = document.getElementById('hint');

  let currentImage = null;
  let dragging = false;

  function storageKey(src){ return `spinnerPos:${src}`; }

  function pickImage(){
    const last = sessionStorage.getItem('lastImg');
    const pool = (CONFIG.preventImmediateRepeat && last)
            ? IMAGES.filter(i => i.src !== last) : IMAGES.slice();
    const choice = pool[Math.floor(Math.random()*pool.length)];
    sessionStorage.setItem('lastImg', choice.src);
    return choice;
  }

  function load(){
    currentImage = pickImage();
    imgEl.src = currentImage.src;
    imgEl.alt = currentImage.alt || 'Derpy cat';

    // spinner position: saved > per-image default > global default
    const saved = localStorage.getItem(storageKey(currentImage.src));
    let pos = currentImage.spinner || CONFIG.defaultSpinner;
    if(saved){ try{ pos = JSON.parse(saved); }catch(e){} }
    setSpinner(pos.x, pos.y);

    // header microtext
    if(Array.isArray(CONFIG.microtexts) && CONFIG.microtexts.length){
      let i = Math.floor(Math.random()*CONFIG.microtexts.length);
      micro.textContent = CONFIG.microtexts[i];
      if(CONFIG.microtextRotateMs > 0){
        setInterval(()=>{
          i = (i+1)%CONFIG.microtexts.length;
          micro.textContent = CONFIG.microtexts[i];
        }, CONFIG.microtextRotateMs);
      }
    }

    // hint visibility only if draggable is enabled
    hint.classList.toggle('show', !!CONFIG.draggable);
  }

  function setSpinner(xPct, yPct){
    xPct = Math.max(0, Math.min(100, xPct));
    yPct = Math.max(0, Math.min(100, yPct));
    spinner.style.left = xPct + '%';
    spinner.style.top  = yPct + '%';
    spinner.dataset.x = xPct.toFixed(2);
    spinner.dataset.y = yPct.toFixed(2);
  }

  function saveSpinner(){
    if(!currentImage) return;
    const x = parseFloat(spinner.dataset.x || '50');
    const y = parseFloat(spinner.dataset.y || '50');
    localStorage.setItem(storageKey(currentImage.src), JSON.stringify({x,y}));
  }

  /* Drag handlers (mouse + touch) — enabled only when CONFIG.draggable */
  function stagePointToPercent(clientX, clientY){
    const r = stage.getBoundingClientRect();
    return { x: ((clientX - r.left)/r.width)*100, y: ((clientY - r.top)/r.height)*100 };
  }
  function startDrag(e){ if(!CONFIG.draggable) return; dragging=true; spinner.classList.add('dragging'); moveDrag(e); e.preventDefault(); }
  function moveDrag(e){ if(!dragging || !CONFIG.draggable) return; const t=e.touches?e.touches[0]:e; const {x,y}=stagePointToPercent(t.clientX,t.clientY); setSpinner(x,y); }
  function endDrag(){ if(!dragging) return; dragging=false; spinner.classList.remove('dragging'); if(CONFIG.draggable) saveSpinner(); }

  // mouse
  spinner.addEventListener('mousedown', startDrag);
  window.addEventListener('mousemove', moveDrag);
  window.addEventListener('mouseup', endDrag);
  // touch
  spinner.addEventListener('touchstart', startDrag, {passive:false});
  window.addEventListener('touchmove', moveDrag, {passive:false});
  window.addEventListener('touchend', endDrag);

  // init
  load();
</script>
</body>
</html>